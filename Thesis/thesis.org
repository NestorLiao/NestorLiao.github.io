#+LATEX_CLASS: report
#+LATEX_COMPILER: xelatex
Time: Mon Dec 16 08:15:20 PM CST 2024
Plan to Complete: Before 2025
E-Ink MP3 Player (STM32 in Rust)
ANC Headphones

* ProjectHunt-选题
** My Personal Taste
- Dislike :: AI stuff(Unpredictable/Python Stuff)/Bio Relate(Unpredictable/Bio Expriment)/Only Hardware(Unstable/Lack Experience and Equipment)
- Goals :: Simplicity and Fun/General Purpose/Job Relate(linux, low-level, controlable, reproducible)
** Layer of This Project

3s:small-simplicity-stupid
against
3s:sport-social media-sex
耳机 主动
Device: FPC ANS headphone + zeInK 
App: Mp3 Player, +Texting, Phone Call+, Time Schedule, +Ai Ask+,  payment, PPG
OS:+ZRO-Zig Real-time Operation-system+ Rust
Lang: +Zig+ Rust, .... bbecause rust have more wheels already built.
Mcu: +rp2040+  stm32f103c8t6..... Qemu... no choice, sorry
Five modules: Eink, ???some gpio, SD card, Mirco 麦克？, PPG  

* Essential Env & Anlysis- 环境与分析
** reproducible enviroment setup
*** [[https://github.com/the-nix-way/dev-templates][Language env]] setup
+ Latex :: Emacs Org-mode to latex, then latex to [[https://github.com/coding-tan/CQUPTtex][CQUPTtex]]
+ Nix :: Github CI/CD and OS build
+ Rust :: Mainly using for Cult Belief
+ C :: Device Driver
+ C++ :: too above
+ Bash :: write a Script for fasting test
*** Build  System

** Other People's Work
+ [[https://oshwhub.com/lovelessing/d133-mobile-phone-development-bo][基于D133的智能手机]]
+ [[https://oshwhub.com/honglin/First_CRT_SmartPhone][【很新但很旧】如何用最古老的技术造一台现代手机？]]
+ [[https://oshwhub.com/zwxb/based-on-rk3566-taishan-pie-dolp][泰山派通话智能手机设计]]
+ [[https://oshwhub.com/li-chuang-kai-fa-ban/tai-shan-pai-pang-niu-shou-ji-kuo-zhan-ban][【胖妞手机】泰山派RK3566开发板]]
+ [[https://oshwhub.com/ludas/mo-shui-ping-qu-dong][墨水屏Eink通用驱动板【验证通过】 - 立创开源硬件平台]]
+ [[https://oshwhub.com/jie326513988/ESP32mi-ni-mo-shui-ping-MP3shou-][ESP32墨水屏MP3收音机阅读器 - 立创开源硬件平台]]
+ [[https://oshwhub.com/shukkkk/4-2-mo-shui-ping_copy_copy_copy][墨水屏TF卡电子书源码开源 - 立创开源硬件平台]]
+ [[https://www.hackster.io/news/the-zerophone-a-linux-smartphone-powered-by-the-raspberry-pi-zero-286f36a25fd4][The ZeroPhone, a Linux Smartphone Powered by the Raspberry Pi Zero - Hackster.io]]
+ [[https://github.com/evanman83/OURS-project][evanman83/OURS-project: Step-by-step instructions to build a smartphone that is open-source, upgradeable, repairable, and Big Tech free.]]

* Impletation-实现过程
** Project Steps 

*** Cross Compileing
*** Qemu Virtual Machine
*** Learn Zig
*** Learn to write a Rtos


*** Key Skills to Focus On
1. *Eink Refresh Algorithm*(目前不知，1.54寸应该不怎么需要).
2. *PPG Predict Info Algorithm*(之前做过的，再实现一遍).
+3. *Embedded Zig & RtOs*(创新性(第一个闲得用zig写rtos 的人)).+
4. *ANS FPC & Device PCB Design* (JLC)(现有产品与ieee论文背书).
5. *Simple 3D Model*(Onshape)(就是个方壳).
   

*** 最最最重要的参考资料
 [[https://oshwhub.com/qwqoffice/pulse-wave-and-heart-rate-display-based-on-ppg][基于PPG的脉搏波及心率显示]] ＋ [[https://oshwhub.com/ludas/mo-shui-ping-qu-dong][墨水屏Eink通用驱动板]]+ [[https://oshwhub.com/jie326513988/esp32c3-154-ink-screen-multi-function][ESP32C3-1.54墨水屏-多功能]]  = [[http://norvig.com/21-days.html][轻松毕业]]

e
* Thesis-基于墨水屏的 +手机+ 极简掌机与降噪耳机设计：面向健康监测与数字生活的创新探索

** 摘要

本项目旨在设计一款简约高效的MP3播放器，集成主动噪声取消（ANC）与健康监测功能。随着智能设备的普及，音频设备不仅要满足高质量的音频播放需求，还应结合健康监测功能，提供更加全面的用户体验。通过结合现代嵌入式技术与PPG传感器，这款设备能够实时监测心率、血氧等健康数据，并提供高保真的音频播放体验。项目的核心贡献包括基于STM32平台的硬件设计、Rust语言开发的驱动程序和任务调度系统，以及优化的低功耗算法。本研究为开发创新型音频设备与健康监控系统提供了技术路径，并展示了嵌入式开发中的多方面应用。

** 引言

*** 研究背景与意义

随着智能设备的普及，尤其是耳机和MP3播放器的智能化，现代用户的需求逐渐多元化。传统音频设备虽然能够提供音质和基本功能，但往往依赖于智能手机，导致用户体验分散并且功能不集成。与此同时，健康管理的需求不断增长，特别是在运动和日常生活中，如何方便、实时地监测心率、血氧等健康数据已成为用户关注的热点。因此，开发一款简约的MP3播放器，不仅满足音频需求，同时能够提供健康数据监测，是本项目的出发点。

通过采用电子墨水显示屏（EPD）作为显示界面，本设备能够有效减少能耗，并提供清晰的显示效果。与传统液晶显示屏相比，电子墨水屏的低功耗和可视角度优势使其成为便携式设备的理想选择。结合PPG传感器监测健康数据，可以为用户提供精准的生理参数反馈，增强健康管理的便捷性。

*** 研究目标与创新点

本项目的目标是开发一款简洁、高效、集成健康监测与音频播放的MP3播放器，具备主动噪声取消功能。通过使用PPG传感器实时检测用户的心率、血氧饱和度（SpO2）等健康数据，设备能够在播放音乐的同时，提供健康数据监控与反馈。该设备的创新点在于通过简化的UI设计提升用户体验，同时采用Rust语言进行系统开发，充分利用其安全性和性能优势，从而实现硬件与软件的高效协同。此设计的另一创新点是将ANC电路集成到播放器中，减少外界噪音的干扰，使用户能够享受高质量的音频播放。

** 理论基础

*** 电子墨水屏技术

电子墨水屏（E Ink）技术以其低功耗、高对比度、宽视角等特点，在便携设备中被广泛应用。其工作原理基于电子纸的微胶囊技术，可以在无需电力支持的情况下维持图像显示，从而大大延长设备的使用时间。在本项目中，电子墨水屏用于显示健康监测数据和音乐播放信息，使得用户在长时间使用过程中不会因屏幕耗电而频繁充电。

*** PPG传感器技术

光电容积脉搏波（PPG）传感器是一种利用光吸收变化原理，监测血流波动的传感器。它通过发射光并测量反射光的变化，进而计算出与心脏跳动相关的生理参数，如心率和血氧饱和度。随着技术的进步，PPG传感器的精度和稳定性得到大幅提升，并逐步应用于智能健康监测设备。本文所选用的MAX30102传感器具备高精度的光学测量能力，适用于实时监控心率和血氧。

*** 嵌入式系统与Rust语言

嵌入式系统通常运行在资源有限的环境中，面对实时性要求和硬件性能限制的挑战。传统的嵌入式开发多依赖C语言，但其指针操作和内存管理容易导致程序错误。而Rust语言凭借其内存安全、并发控制和高效的性能，成为一种理想的选择。Rust特别适合用在硬件接口驱动开发中，不仅能够保证程序的安全性，还能在性能上与C语言竞争。

** 硬件设计

*** 系统架构

本系统采用STM32F103C8T6微控制器，具备较高的处理能力和丰富的外设接口，适合用于音频播放与实时健康监控。系统包括PPG传感器、电子墨水显示屏、PCM5102A DAC、TPA3136放大器和ANC模块。各组件通过SPI、I2C和I2S接口进行通信与数据传输，确保系统的高效协同工作。通过集成TPA3136放大器与ANC电路，系统能够输出高质量音频并有效减少外界噪音干扰。

*** PCB设计与硬件实现

在硬件设计中，重点考虑了电路的功耗优化和信号稳定性。各模块之间的连接通过高质量的PCB布局实现，以避免信号干扰和电源不稳定问题。针对不同的模块需求，硬件设计采用了模块化接口，使得未来扩展更加灵活。特别是在音频与健康数据的处理模块之间，信号传输必须保持高精度，以保证音频输出质量与健康监测的准确性。

*** 外壳与集成设计

外壳设计采用3D打印技术，不仅能够有效测试与优化设计，还具备较好的结构强度和成本效益。为了保证设备的便携性与美观，外壳设计简约而具有现代感，符合用户对智能硬件的审美要求。此外，外壳材料选择注重环保与可持续性，符合绿色设计理念。

** 软件开发

*** 驱动与任务调度

本项目的软件开发主要采用Rust语言，利用RTIC实现实时中断驱动并发任务调度。驱动程序支持各个硬件模块的有效运行，包括PPG传感器、电子墨水显示屏、音频输出模块等。RTIC调度器确保了任务的高效分配与执行，使得系统可以在处理多项任务时不会出现延迟或资源竞争。

*** 健康监测与音频播放

健康数据如心率和血氧通过PPG传感器实时采集，并在电子墨水屏上显示。为了确保显示的实时性和准确性，系统每隔一定时间更新显示数据。音频数据则通过SD卡读取，并通过I2S接口流式传输到PCM5102A DAC，最后通过TPA3136放大器驱动耳机播放高质量音频。

*** 用户界面与控制

用户界面设计强调简约与高效，确保用户能够在最少的操作下完成常用功能的控制。电子墨水显示屏不仅显示健康数据和曲目信息，还提供直观的UI元素，如图标、按钮和进度条。旋转编码器用于音量控制和菜单导航，而按钮映射则支持播放/暂停、曲目切换、ANC开关等功能。

** 实验与测试

*** 系统验证与性能测试

本章将通过一系列的实验与测试，验证设备在实际使用中的性能。测试将包括音频播放质量、ANC效果以及健康监测功能的准确性评估。此外，电子墨水屏的刷新速度、显示效果以及系统在不同环境下的稳定性也将成为测试的重点。

*** 用户体验评估

通过收集用户的反馈，本章将对设备的舒适度、操作便捷性和性能进行评估。特别是在长期使用过程中，用户对设备的舒适性、操作界面的响应速度和健康数据准确性的评价将是衡量产品成功的重要标准。

** 结论与展望

*** 主要研究成果

本项目成功设计并实现了一款集成音频播放与健康监测功能的简约MP3播放器。通过创新性地结合PPG技术和实时反馈，本设备能够提供高效、准确的健康监控功能，并且通过优化的音频输出系统和ANC电路，提升了用户的音频体验。

*** 存在的局限性

尽管本系统在多项功能上实现了创新，但电子墨水屏的刷新速度可能会对某些实时显示的流畅度产生一定影响，尤其是在显示快速更新的健康数据时。此外，在极端运动环境下，传感器可能会受到一定的干扰，从而影响数据的准确性。

*** 未来工作

未来的工作将集中在优化ANC电路的性能，提升噪声消除的效果和精度。此外，随着传感器技术的发展，未来可以考虑引入更高效的传感器和算法，从而提升健康监测功能的精度与范围，进一步拓宽设备的应用场景。

** 附录

- 硬件手册：包括电子墨水显示屏、PPG传感器和MCU的技术规格。
- 软件代码：包括核心驱动程序与应用程序代码。
- 测试数据：关于功耗、健康监测精度及用户体验的详细数据。




* Presentation-系统实现与挑战
** 系统需求分析
    详细讨论系统需求及其如何在设计过程中得到满足。
    
** 开发环境与工具
    概述用于硬件（PCB设计、SoC配置）、软件（）和测试的开发工具。
** 设计与实现挑战
    在硬件设计、PCB布局、驱动开发和软件优化过程中遇到的挑战。
    屏幕刷新算法
    ppg传感器的运用
    zig语言的使用
    
    3d设计

** 学到的经验
    从定制硬件、低级软件开发及在嵌入式系统中集成xxx的经验中获得的洞见。

** 本章小结
    对本章内容进行总结。



    
